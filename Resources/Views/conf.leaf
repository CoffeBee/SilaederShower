<!DOCTYPE html>
<html>
   <head>
      <link rel="stylesheet" href="/styles/home_css.css">
      <script src="/home_scripts.js"></script>
      <meta charset="UTF-8">
      <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
      <script   src="https://code.jquery.com/jquery-3.6.1.min.js"   integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ="   crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

   </head>
   <body>
      
      <div id="slidebar" class="slidebar" onmouseover="openNav();" onmouseout="closeNav();">
         <div id="contentInNav" style="height: calc(100% - 60px); visibility: hidden; transition: visibility 100ms;">
            <img src="/images/logo.svg" class="logo">
            <div class="sidebar-content">
               
               #for(conf in confs):
               <button class="sidebar-conferences #if(conf.selected):
               choosen
               #endif" onclick="location.href='/cf/#(conf.id)'">#(conf.title)</button>
               #endfor
               
            </div>
            <form action="/cf/add" method="post" style="position: absolute; bottom: 120px">
               <button class="sidebar-conferences "  onclick="" id="button-plus">
               <img src="/images/plus.svg" class="plus">
               </button>
            </form>
            <div class="sidebar-info">
               <div style="font-family: Raleway; font-weight: 600; color: #464255; font-size: 15px; margin-bottom: 16px;">
                  Silaeder shower system<br>
               </div>
               <div style="font-family: Raleway; font-weight: Normal; color: #a3a3a3; font-size: 13px;">
                  <div style="margin-bottom: 16px;">
                     © 2022 All Rights Reserved<br>
                  </div>
                  Made with ❤️ in Silaeder
               </div>
            </div>
         </div>
         <div id="logoInNav" style="height: calc(100% - 60px); visibility: visible; transition: visibility 100ms;">
            <img src="/images/logo_simple.svg" style="position: absolute; left: 43px; top: 30px">
         </div>
      </div>
   </div>
   <div id="app" >
      
      <div class="header">
         <span class="Info">
            
            <span style="font-family: Raleway; font-weight: 600; font-size: 32px;border: none;
               outline: none; display: block;
               border-radius: 0;
            margin-bottom: 0px; margin-top: 0px;width: auto; background: transparent" @blur="sendTitle" contenteditable>{{title}}</span>
            
            <span style="font-family: Raleway; font-weight: 400; font-size: 14px;border: none;
               outline: none; display: block; margin-top: 16px;
               border-radius: 0;
            margin-bottom: 0px;;width: auto; background: transparent" @blur="sendDetail" contenteditable>{{detail}}</span>
         </span>
         <img src="/images/start.svg" style="margin-left: 35px; height: 80px; width: 80px;">
         <img src="/images/peoples.svg" style="margin-left: 35px; height: 80px; height: 80px">
      </div>

      <div id="plan">
         <div class="section" v-for="(section, index) in sections">
            <div style="height: 60px; margin-bottom: 20px"> 
               <div style="display: flex; justify-content: space-between;" v-if="index == sections.length - 1">
                  <span style="font-family: Raleway; font-weight: 500; font-size: 21px;border: none;
               outline: none; display: block;
               border-radius: 0; color: #464255;
            margin-bottom: 0px;;width: auto; background: transparent" @blur="sendName(index, $event)" contenteditable>{{section.name}}</span>
                  <img src="/images/add.svg" @click="sectionAdd"/>
               </div>
               <span v-if="index != sections.length - 1" style="font-family: Raleway; font-weight: 500; font-size: 21px;border: none;
               outline: none; display: block;
               border-radius: 0; color:  #464255;
            margin-bottom: 0px;;width: auto; background: transparent" @blur="sendName(index, $event)" contenteditable>{{section.name}}</span>
            </div>
            <div class="projects">
               <div style="width: 300px; height: 150px; background: #ECEAF3; border-radius: 25px;padding: 15px;" @mouseover="section.hover = true" @mouseleave="section.hover = false; search = null" >
                  <Transition>
                     <input v-model="search" @keyup="searchProject" class="new-project" placeholder="Новый проект"  v-if="section.hover"/>
                     <div v-if="results.length != 0 && section.hover == true" style="padding: 15px 25px; border-radius: 25px;">
                        <p v-for="(res, res_i) in results" style="margin: 0; font-family: 'Raleway'; font-size: 12; font-weight: 400; color: #464255" >{{res}}</p>
                     </div>
                  </Transition>
               </div>
            </div>
         </div>
      </div>
   </div>
   <script>
   openNav();
   </script>
</body>
<script>

const {createApp} = Vue
createApp({
   data() {
      return {
         title: '#(title)',
         detail: '#(detail)',
         confID: '#(confID)',
         sections: [],
         search: null,
         results: []
      }
   },
   mounted() {
    axios({
        method: 'get',
        url: '/cf/section/' + this.confID
      }).then((response) => {
       this.sections = response.data
     })
     .catch(function (error) {
       console.log(error);
     });
  },
   methods: {
    sendTitle(e) {
      this.title = e.target.innerHTML;
      axios({
        method: 'post',
        url: '/cf/title/' + this.confID,
        data: {
          title: this.title,
        }
      }).then(function (response) {
       console.log(response);
     })
     .catch(function (error) {
       console.log(error);
     });
    },
    sendDetail(e) {
      this.detail = e.target.innerHTML;
      axios({
        method: 'post',
        url: '/cf/detail/' + this.confID,
        data: {
          detail: this.detail,
        }
      }).then(function (response) {
       console.log(response);
     })
     .catch(function (error) {
       console.log(error);
     });
    },
    sectionAdd(e) {
      axios({
        method: 'post',
        url: '/cf/section/' + this.confID
      }).then( (response) => {
       this.sections.push(response.data)
     })
     .catch(function (error) {
       console.log(error);
     });
    },
    sendName(sec_index, e) {
      this.sections[sec_index].name = e.target.innerHTML;
      axios({
        method: 'post',
        url: '/cf/sc/name/' + this.sections[sec_index].id,
        data: {
          name: this.sections[sec_index].name,
        }
      }).then(function (response) {
       console.log(response);
     })
     .catch(function (error) {
       console.log(error);
     });
    },
    searchProject() {
      if (this.search.length > 3) {
         this.results = ["ABOBA", "BOBO", "COCO"]
      }
    }
  }
}).mount('#app')
</script>
</html>
